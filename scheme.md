# 无限修仙——网页挂机单机游戏设计文档

## 一、境界体系设计

### 1. 大境界层级（7阶）

炼体境 → 凝气境 →
筑基境 → 金丹境 → 元婴境 → 化神境 → 渡劫境

### 2. 小境界细化（每大境9层）

每个小境界突破和大境界突破都需要灵气

- **基础函数模型**

设当前境界为 R（炼体境=1，凝气境=2,...,渡劫境=7），小境界为 r（1≤r≤9），则第R大境第r小境的灵气需求 ​Q(R,r) 为

Q(R,r) = Q₀ × (1 + α)^(R-1) × [1 + β×(r-1)] × γ(R,r)

- **Q₀**：炼体境第一层基础值（建议100~500）
- **​α**：大境跃迁系数（建议0.6~1.2）
- **β**：小境递增斜率（建议0.15~0.3）​
- **γ(R,r)**：动态修正因子 = 1 + 0.1×sin(π×(R+r)/6)（模拟月相周期影响

- **参数优化建议**

| 参数 | 作用                 | 取值范围                 |
| ---- | -------------------- | ------------------------ |
| ​α   | 控制跨大境难度跃升   | 0.6（平缓）~1.2（陡峭）  |
| ​β   | 调节同大境内增长速率 | 0.15（线性）~0.3（指数） |
| ​γ   | 引入随机波动策略     | ±10%周期性修正           |

### 3.动态调整机制

**1.​衰减补偿**：突破失败时，触发公式：

Q'(R,r) = Q(R,r) × max(0.8, (1 - 0.05)^失败次数)

**2.​天劫加成**：在渡劫期（R=7）时激活：

Q(7,r) = Q(7,r) × [1 + 0.2×(r-1)]

（体现"九九重劫"的递增难度）

### 4.灵气获取补偿

- 离线收益按 Q(R,r)×(1 - e^(-kt)) 计算（k为洞府等级系数）

- 洞府聚灵阵提供 Q(R,r)×0.2×灵根等级 的永久减免

---

## 二、灵气系统设计

### 1. 双轨收集机制

- **手动收集**：点击/拖拽操作获取基础灵气（1-5单位/次）
- **自动挂机**：每秒获得(0.1×当前灵气浓度)×灵根契合度单位
- **浓度周期**：按现实时间每6小时波动：

```javascript
// 浓度计算公式（示例）
const phase = (Date.now() % 21600000)/21600000; // 6小时周期
const concentration = 0.5 + Math.sin(phase*2π)*0.5; // 0-1波动
```

## 三、五行灵根系统

- **​属性点分配**：每小境界突破获得3点，可投入：

| **灵根** | **属性加成**     | **特殊组合效果（需相邻灵根≥3级）** |
| -------- | ---------------- | ---------------------------------- |
| 金灵根   | 攻击+1%/级       | 金+火：暴击率提升（等级和×0.5%）   |
| 木灵根   | 生命恢复+0.5%/级 | 木+水：灵气吸收效率+10%            |
| 水灵根   | 防御+0.8%/级     | 水+土：突破失败惩罚降低20%         |
| 火灵根   | 暴击伤害+1.2%/级 | 火+土：挂机收益+15%                |
| 土灵根   | 最大生命+2%/级   | 五行全3级：触发"生生不息"持续回灵  |

## 四、特殊体质继承机制

- **突破奖励**：大境突破时按概率获得（可叠加）：

| **体质类型** | **触发概率** | **效果（示例）**            | **继承概率** |
| ------------ | ------------ | --------------------------- | ------------ |
| 先天道体     | 8%           | 灵气吸收速度+30%，持续3小境 | 40%          |
| 不灭战体     | 5%           | 防御提升50%，但突破难度+20% | 25%          |
| 玄阴灵体     | 3%           | 夜间挂机效率翻倍            | 60%          |
| 轮回圣体     | 1%           | 重生时保留30%当前境界进度   | 100%         |

- **突破失败处理**：损失当前大境30%灵气，但有：

  - 20%概率触发"兵解重生"，保留1个随机体质
  - 5%概率获得"破而后立"状态：下次突破成功率+25%
  - 继承规则：体质继承概率=原概率×（1 - 失败次数×0.1）

## 五、渡劫概率函数设计（五行灵根版）

### 基础函数定义

设五行灵根点数为 $K$（金）、$M$（木）、$S$（水）、$H$（火）、$T$（土），总灵根点数 $Total = K + M + S + H + T$

### 基础概率公式

```math
\begin{aligned}
P_{成功} &= \frac{1}{1 + e^{-(0.1Total + \alpha)}} \times (1 + \frac{\max(K,H)}{100}) \\
P_{失败} &= (1 - P_{成功}) \times \frac{1}{1 + e^{0.05(T + M)}} \\
P_{死亡} &= 1 - P_{成功} - P_{失败}
\end{aligned}
```

其中 α 为境界修正系数（炼气期=0.5，渡劫期=2.5）

### 动态调整机制

1. **轮回继承系数**

```math
P_{死亡}=P_{死亡}\times (1-0.1\times 轮回次数)^2
```

2. **灵气浓度修正**

```python
def environment_effect(concentration):
    # 浓度范围0.0-1.0，取自月相周期[2](@ref)
    return {
        'success': 1 + 0.2 * sin(2π * concentration),
        'death': 1 - 0.15 * concentration**2
    }
```

## 六、基础属性架构

### 1. 核心战斗三围

- ​**生命值**：由根骨、木灵根、装备防御词条共同决定，直接影响生存能力[7,8](@ref)
- ​**攻击力**：包含物理攻击（力道/金灵根）和道术攻击（灵力/火灵根）双维度，需配合命中属性生效[7,8](@ref)
- ​**防御值**：分为物理防御（筋骨/土灵根）和道术防御（水灵根），通过装备词条可强化[7,9](@ref)

### 2. 战斗效能属性

- ​**命中/闪避**：每点身法提升0.3%闪避率，闪避成功可触发反击[7,8](@ref)
- ​**暴击/韧性**：暴击伤害最高可达300%，韧性每点降低1.2%被暴击概率[2,7](@ref)
- ​**攻速/移速**：受装备词条和风系功法影响，最高可突破2.5攻击/秒[2,9](@ref)

### 3. 全局成长属性

- ​**灵气吸收效率**：根骨值×灵根平均等级×洞府等级的综合函数[5,7](@ref)
- ​**修为转化率**：影响境界突破时的属性增益幅度，最高可达150%[9,10](@ref)
- ​**奇遇触发率**：由气运值+当前时辰相位决定，满月夜加成300%[6,9](@ref)

### 4. 先天特质

- ​**轮回印记**：重生时保留15%基础属性，可叠加3层[4,10](@ref)
- ​**天道赐福**：渡劫失败后获得，下次突破成功率+25%[6,9](@ref)
- ​**灵根共鸣**：五行灵根差值≤2时，全属性提升10%[3,9](@ref)

### 5. 动态修正系统

```javascript
// 昼夜修正算法（网页9演化）
function calcNightBonus(attack) {
  const moonPhase = getLunarPhase()
  return attack * (1 + moonPhase * 0.15)
}
// 五行相克补偿（网页8改良）
function elementPenalty(attacker, defender) {
  const克制系数 = 1.2 - (defender.elementLevel - attacker.elementLevel) * 0.05
  return Math.max(0.5, Math.min(1.5, 克制系数))
}
```

### 6.先天属性
